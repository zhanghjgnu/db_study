## oracle 11g 服务器升级到oracle 12c的客户端连接问题

原来系统是oracle11g RAC(x64 linux)的服务器，今天重装服务器选用了oracle12.2.0.1(X64 linux),两台12c服务器通过data guard做成实时数据备份,部署完成,Switchover
和Failover成功之后一通窃喜。
考虑到实际用户环境客户端都是10g,为了稳妥起见做一下客户端测试，这一下遇到意想不到的问题:
###    1.在win10 X64系统上安装oracle10g客户端,建立网络连接测试时提示找不到协议，跳过再说。
在tnsnames.ora中建立连接串:
```
CDB1 =
  (DESCRIPTION =
    (ADDRESS_LIST =
      (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.100.178)(PORT = 1521))
    )
    (CONNECT_DATA =
      (SERVICE_NAME = cdb1)
    )
  )

cdb1_stby =
  (DESCRIPTION =
    (ADDRESS_LIST =
      (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.100.179)(PORT = 1521))
    )
    (CONNECT_DATA =
      (SID = cdb1)
    )
  )
```

然后用sqlplus建立数据库连接:
sys@cdb as sysdba
输入正确密码后提示 ORA-28040:没有匹配的验证协议
google了一通原来是oracle升级后的版本兼容性问题,解决方案如下:
    分别打开两个服务器(Primary/Standby)的服务端,修改$ORACLE_HOME/network/admin/sqlnet.ora文件,修改如下
```
# Generated by Oracle configuration tools.

NAMES.DIRECTORY_PATH= (TNSNAMES, EZCONNECT)
SQLNET.ALLOWED_LOGON_VERSION=8
SQLNET.ALLOWED_LOGON_VERSION_CLIENT=8
SQLNET.ALLOWED_LOGON_VERSION_SERVER=10
```
其中后三行是新增的，第一个参数是客户端连接到服务器的时候启作用，第二个是做为客户端去连接其它数据库的时候启作用，第三个参数是作为客户端允许连到另一个服务器的最小版本。
好像也可以这么写(没去验证):SQLNET.ALLOWED_LOGON_VERSIONS=(12,11,10,9,8,7)该语句表示支持oracle7-12版本的链接
    这样改完了reload监听
```    
    $ lsnrctl
    LSNRCTL>reload
```    
这时候客户端连接不提示这个错误了，不过提示ORA-01017用户名密码错误，我确认没输错，还得继续下一步。

### 2.我们配置的sqlnet对之前已经存在的帐号并没有生效，他们还保持在之前的兼容性
```
  SQL>select username,password_versions from dba_users;
```  
  可以看到版本最低是11g，还有个12c，要做的就是在服务器端修改密码
```  
  SQL>alter user sys identified by zhubajie;
```  
  修改完成后再一次从windows10的客户端用sqlplus登录
```  
  sys@cdb1 as sysdba
```  
  输入密码
  正常登录。
3.windows客户端访问oracle12c服务器的问题解决了，我们还有一些web应用，使用了jdbc驱动，发现还是连不上，这个问题就比较简单了，把jdbc14.jar驱动换一下新版本的驱动，比如ojdbc6.jar就可以了。


